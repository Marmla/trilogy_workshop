---
title: "Trilogy Workshop"
description: |
  An introduction to using data science tools for folklore taxonomy and text analysis
author:
  - name: Josh Hagedorn 
    url: https://www.j-hagedorn.com/
    orcid_id: 0000-0001-8026-7562
date: "`r Sys.Date()`"
output: 
  distill::distill_article:
    code_folding: true
---

# Load packages and trilogy data sets

Let's start by loading the materials we'll need:

- the R packages we'll use
- the `trilogy` datasets

The main package we'll use is the [tidyverse](https://www.tidyverse.org/), which is actually a collection of R packages with consistent design philosophy, grammar, and data structures.

To pull the current versions of the datasets, we'll follow the steps outlined in the [Getting Started > Use in Reproducible Research](https://github.com/j-hagedorn/trilogy/blob/master/docs/vignettes/getting_started.md#use-in-reproducible-research) vignette.  That's why you'll see a long, alphanumeric code in the links below, specifying precisely what version of the data is being used.

```{r setup}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)

tmi <- read_csv("https://raw.githubusercontent.com/j-hagedorn/trilogy/490a989d199d9440f9210bfe6ede797b03c4e26e/data/tmi.csv")
atu_df <- read_csv("https://raw.githubusercontent.com/j-hagedorn/trilogy/490a989d199d9440f9210bfe6ede797b03c4e26e/data/atu_df.csv")
atu_seq <- read_csv("https://raw.githubusercontent.com/j-hagedorn/trilogy/490a989d199d9440f9210bfe6ede797b03c4e26e/data/atu_seq.csv")
aft <- read_csv("https://raw.githubusercontent.com/j-hagedorn/trilogy/490a989d199d9440f9210bfe6ede797b03c4e26e/data/aft.csv")

```

This allows us to explicitly reference a version of the data so that any research we do can be precisely replicated by others.  For instance, if you wanted to pull an old (and not yet cleaned-up) version of the `aft` dataset, you'd just need to go back in the GitHub history and run the following:

```{r old_aft, echo=TRUE}
old_aft <- read_csv("https://raw.githubusercontent.com/j-hagedorn/trilogy/f0fb12d108734847114f17980b05686a26305e38/data/aat.csv")
```


# Inspecting the data

## Motifs

The `tmi` is comprised of `r n_distinct(tmi$id)` distinct motifs.  It is grouped into chapters, including: *`r paste(unique(tmi$chapter_name), collapse = ", ")`*

Under the chapter level, it has multiple nested levels of groups, which are named as follows:

- `level_0` = What Thompson labelled 'Grand divisions', sections divisible by 100.
- `level_1` = Smaller divisions end with '0', These are defined at intervals of 10.
- `level_2`-`level_6` = Various sections with multiple layers of subdivisions

The excerpt below shows how this hierarchy structure is represented in the flat dataset:

```{r, layout="l-body-outset"}
tmi %>%
  filter(level_2 == "B122") %>%
  select(chapter_id,id,motif_name,level,starts_with("level_")) %>%
  select(-level_5,-level_6) %>%
  arrange(id) %>%
  rmarkdown::paged_table()
  
```

Note that some motifs are not fit into the hierarchical level format.  This occurs when there is a zero indicator at one of the decimal indices, since this creates a break in the hierarchical structure.  For instance, in the "A111.3" section, we find A111.3 as a parent motif for A111.3.1-3, but there is no A111.3.0 to serve as a parent for A111.3.0.1.

```{r}
tmi %>%
  filter(str_detect(id,"^A111.3")) %>%
  select(id, motif_name) %>%
  arrange(id) %>%
  rmarkdown::paged_table()
```

The table below shows how many motifs (i.e. `n_motifs`) are in each chapter, and each level (*if you expand the row*).

```{r tmi_summary_tbl}
library(reactable)
tmi %>%
  group_by(chapter_name,level) %>%
  summarize(n_motifs = n_distinct(id)) %>%
  reactable(
    groupBy = c("chapter_name"),
    columns = list(
      level = colDef(
        aggregate = "count",
        format = list(
          aggregated = colFormat(suffix = " levels")
        )
      ),
      n_motifs = colDef(aggregate = "sum")
    )
  )
```


## Tale Types

## Annotated Tales

# 

- Joining together data sets by primary key
- First analysis: coverage of motif index in the tale type index
- Visualization
- Adding citations
- Where to go next?



